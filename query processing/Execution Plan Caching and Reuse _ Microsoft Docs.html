<!DOCTYPE html>
<!-- saved from url=(0095)https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms181055(v%3dsql.105) -->
<html class="js hasSidebar hasPageActions hasBreadcrumb conceptual noTouch theme_night" lang="en-us" dir="ltr" data-authenticated="false" data-render="docs"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<link rel="stylesheet" href="./Execution Plan Caching and Reuse _ Microsoft Docs_files/4a-45f526"><link rel="stylesheet" href="./Execution Plan Caching and Reuse _ Microsoft Docs_files/override.css">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta property="og:title" content="Execution Plan Caching and Reuse">
	<meta property="og:image" content="https://docs.microsoft.com/_themes/docs.theme/master/en-us/_themes/images/microsoft-header.png">


		<meta name="is_archived" content="true">
<meta name="ROBOTS" content="NOINDEX,FOLLOW">
<meta name="author" content="Archiveddocs">
<meta name="ms.author" content="Archiveddocs">
<meta name="breadcrumb_path" content="/previous-versions/sql/breadcrumb/toc.json">
<meta name="current_version_url" content="/sql">
<meta name="ms.topic" content="archived">
<meta name="ms.prod" content="sql-server-2008-r2">
<meta name="uhfHeaderId" content="MSDocsHeader-Archive">
<meta name="is_retired" content="true">
<meta name="ms:contentKeyID" content="21940502">
<meta name="TOCTitle" content="Execution Plan Caching and Reuse">
<meta name="ms:assetid" content="3d3ea8fc-fb57-4e06-8d47-3b074c1bc0b8">
<meta name="ms:mtpsurl" content="https://msdn.microsoft.com/en-us/library/ms181055(v=SQL.105)">
<meta name="ms.date" content="10/04/2012">
<meta name="mtps_version" content="v=SQL.105">
<meta name="search.ms_sitename" content="Docs">
<meta name="search.ms_docsetname" content="sql-2008-R2-docs-archive">
<meta name="locale" content="en-us">
<meta name="site_name" content="Docs">
<meta name="search.ms_product" content="MSDN">
<meta name="depot_name" content="MSDN.sql-2008-R2-docs-archive">
<meta name="updated_at" content="2018-04-19 05:44 AM">
<meta name="gitcommit" content="https://docs-archive.visualstudio.com/DefaultCollection/docs-archive-project/_git/sql-2008-2008-r2-docs-archive-pr/commit/edc4dccc8663fa2ba82c49d775b1815d48b6782b?path=%2fsql-server-docs-archive%2fsql-server-2008-r2%2fms181055(v%3dsql.105).md&amp;_a=contents">
<meta name="original_content_git_url" content="https://docs-archive.visualstudio.com/DefaultCollection/docs-archive-project/_git/sql-2008-2008-r2-docs-archive-pr?path=%2fsql-server-docs-archive%2fsql-server-2008-r2%2fms181055(v%3dsql.105).md&amp;version=GBlive&amp;_a=contents">
<meta name="document_id" content="ebf93040-2756-a781-74b2-e679517664a7">
<meta name="document_version_independent_id" content="0f320ec4-e4f6-f55b-2659-5f3582f9873e">
<meta name="page_type" content="conceptual">
<meta name="toc_rel" content="ms181055(v=sql.105)/toc.json">
<meta name="word_count" content="1697">

<link href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms181055(v%3dsql.105)" rel="canonical">
	<title>Execution Plan Caching and Reuse | Microsoft Docs</title>

		<link rel="stylesheet" href="./Execution Plan Caching and Reuse _ Microsoft Docs_files/74eb1240.site-ltr.css">

	<link rel="stylesheet" href="./Execution Plan Caching and Reuse _ Microsoft Docs_files/6ae69eb9.conceptual.css">


	<script async="" src="./Execution Plan Caching and Reuse _ Microsoft Docs_files/analytics.js.download"></script><script>
	var msDocs = {
		data:{
			contentLocale: 'en-us',
			contentDir: 'ltr',
			userLocale: 'en-us',
			userDir: 'ltr',
			pageTemplate: 'Conceptual',
			brand: '',
			context: {

			},
			hasComments: false,
			feedbackSystem: 'LiveFyre',
			feedbackGitHubRepo: '',
			feedbackProductUrl: '',
			contentGitUrl: 'https://docs-archive.visualstudio.com/DefaultCollection/docs-archive-project/_git/sql-2008-2008-r2-docs-archive-pr?path=%2fsql-server-docs-archive%2fsql-server-2008-r2%2fms181055(v%3dsql.105).md&version=GBlive&_a=contents',
			
			forceVersionPicker:false		},
		functions:{},
		settings:{
			extendBreadcrumb: true,
			enableUHFPPE: false
		}
	};
	if (!('Promise' in window && 'resolve' in window.Promise && 'reject' in window.Promise && 'all' in window.Promise && 'race' in window.Promise)) {
		document.write('<script src="/_themes/docs.theme/master/en-us/_themes/global/js/6ee34c01.bluebird.min.js"><\/script>');
	}
	if (typeof fetch !== 'function') {
		document.write('<script src="/_themes/docs.theme/master/en-us/_themes/global/js/d9fc435c.fetch.min.js"><\/script>');
	}
	</script>
	<script src="./Execution Plan Caching and Reuse _ Microsoft Docs_files/jquery-2.2.4.min.js.download"></script>
	<script src="./Execution Plan Caching and Reuse _ Microsoft Docs_files/bd6dcf3c.global.min.js.download"></script><style></style><script src="./Execution Plan Caching and Reuse _ Microsoft Docs_files/jsll-4.js.download" async="" defer=""></script>

<script src="./Execution Plan Caching and Reuse _ Microsoft Docs_files/e4-7aa0d7" defer=""></script></head>

<body lang="en-us" dir="ltr">
<div class="header-holder">
		<div id="headerAreaHolder" data-bi-name="header">    <section id="headerArea" data-m="{&quot;cN&quot;:&quot;headerArea&quot;,&quot;cT&quot;:&quot;Area_coreuiArea&quot;,&quot;id&quot;:&quot;a1Body&quot;,&quot;sN&quot;:1,&quot;aN&quot;:&quot;Body&quot;}">
            <div id="headerRegion" data-region-key="headerregion" data-m="{&quot;cN&quot;:&quot;headerRegion&quot;,&quot;cT&quot;:&quot;Region_coreui-region&quot;,&quot;id&quot;:&quot;r1a1&quot;,&quot;sN&quot;:1,&quot;aN&quot;:&quot;a1&quot;}">

    <div id="headerUniversalHeader" data-m="{&quot;cN&quot;:&quot;headerUniversalHeader&quot;,&quot;cT&quot;:&quot;Module_coreui-universalheader&quot;,&quot;id&quot;:&quot;m1r1a1&quot;,&quot;sN&quot;:1,&quot;aN&quot;:&quot;r1a1&quot;}" data-module-id="Category|headerRegion|headerRegion|headerUniversalHeader|coreui-universalheader">
        






        <a id="uhfSkipToMain" class="m-skip-to-main" href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms181055(v%3dsql.105)#main" tabindex="0" style="z-index:3000002" data-m="{&quot;cN&quot;:&quot;Skip to content_nonnav&quot;,&quot;id&quot;:&quot;nn1m1r1a1&quot;,&quot;sN&quot;:1,&quot;aN&quot;:&quot;m1r1a1&quot;}">Skip to main content</a>


<header role="banner" class="c-uhfh context-uhf" itemscope="itemscope" data-header-footprint="/MSDocs/MSDocsHeader-Archive" data-ckrate="1" data-magict="true" itemtype="http://schema.org/Organization">
    <div class="theme-light js-global-head f-closed " data-m="{&quot;cN&quot;:&quot;Universal Header_cont&quot;,&quot;cT&quot;:&quot;Container&quot;,&quot;id&quot;:&quot;c2m1r1a1&quot;,&quot;sN&quot;:2,&quot;aN&quot;:&quot;m1r1a1&quot;}">
        <div class="c-uhfh-gcontainer">
            <button type="button" class="c-action-trigger c-glyph glyph-global-nav-button" aria-label="Header navigation menu" aria-expanded="false" data-m="{&quot;cN&quot;:&quot;Mobile menu button_nonnav&quot;,&quot;id&quot;:&quot;nn1c2m1r1a1&quot;,&quot;sN&quot;:1,&quot;aN&quot;:&quot;c2m1r1a1&quot;}"></button>
            <button type="button" class="c-action-trigger c-glyph glyph-arrow-htmllegacy" aria-label="Close search" aria-expanded="false" data-m="{&quot;cN&quot;:&quot;Close Search_nonnav&quot;,&quot;id&quot;:&quot;nn2c2m1r1a1&quot;,&quot;sN&quot;:2,&quot;aN&quot;:&quot;c2m1r1a1&quot;}"></button>
                    <a id="uhfLogo" class="c-logo" itemprop="url" href="https://www.microsoft.com/" aria-label="Microsoft" data-m="{&quot;cN&quot;:&quot;GlobalNav_Logo_cont&quot;,&quot;cT&quot;:&quot;Container&quot;,&quot;id&quot;:&quot;c3c2m1r1a1&quot;,&quot;sN&quot;:3,&quot;aN&quot;:&quot;c2m1r1a1&quot;}">
                        <img itemprop="logo" itemscope="itemscope" class="c-image" src="./Execution Plan Caching and Reuse _ Microsoft Docs_files/RE1Mu3b" role="none">
                        <span role="none">Microsoft</span>
                    </a>
            <div class="f-mobile-title">
                <button type="button" class="c-action-trigger c-glyph glyph-chevron-left" aria-label="See more menu options" data-m="{&quot;cN&quot;:&quot;Mobile back button_nonnav&quot;,&quot;id&quot;:&quot;nn4c2m1r1a1&quot;,&quot;sN&quot;:4,&quot;aN&quot;:&quot;c2m1r1a1&quot;}"></button>
                <span data-global-title="Microsoft home" class="js-mobile-title">Docs</span>
                <button type="button" class="c-action-trigger c-glyph glyph-chevron-right" aria-label="See more menu options" data-m="{&quot;cN&quot;:&quot;Mobile forward button_nonnav&quot;,&quot;id&quot;:&quot;nn5c2m1r1a1&quot;,&quot;sN&quot;:5,&quot;aN&quot;:&quot;c2m1r1a1&quot;}"></button>
            </div>

            
            <button type="button" class="c-action-trigger c-glyph glyph-chevron-left js-primary-paddle" data-m="{&quot;cN&quot;:&quot;Previous_nonnav&quot;,&quot;id&quot;:&quot;nn6c2m1r1a1&quot;,&quot;sN&quot;:6,&quot;aN&quot;:&quot;c2m1r1a1&quot;}" aria-label="Show previous" tabindex="-1"></button>
            
            
            
            <button type="button" class="c-action-trigger c-glyph glyph-chevron-right js-secondary-paddle" data-m="{&quot;cN&quot;:&quot;Next_nonnav&quot;,&quot;id&quot;:&quot;nn7c2m1r1a1&quot;,&quot;sN&quot;:7,&quot;aN&quot;:&quot;c2m1r1a1&quot;}" aria-label="Show next" tabindex="-1"></button>

                <div class="c-uhfh-actions" data-m="{&quot;cN&quot;:&quot;Header actions_cont&quot;,&quot;cT&quot;:&quot;Container&quot;,&quot;id&quot;:&quot;c8c2m1r1a1&quot;,&quot;sN&quot;:8,&quot;aN&quot;:&quot;c2m1r1a1&quot;}">
                                <form class="c-search" autocomplete="off" id="searchForm" name="searchForm" role="search" action="https://docs.microsoft.com/en-us/search/index" method="GET" data-seautosuggest="{&quot;queryParams&quot;:{&quot;market&quot;:&quot;en-us&quot;,&quot;clientId&quot;:&quot;7F27B536-CF6B-4C65-8638-A0F8CBDFCA65&quot;,&quot;sources&quot;:&quot;Microsoft-Terms,Iris-Products,DCatAll-Products&quot;,&quot;filter&quot;:&quot;+ClientType:StoreWeb&quot;,&quot;counts&quot;:&quot;5,1,5&quot;},&quot;familyNames&quot;:{&quot;Apps&quot;:&quot;App&quot;,&quot;Books&quot;:&quot;Book&quot;,&quot;Bundles&quot;:&quot;Bundle&quot;,&quot;Devices&quot;:&quot;Device&quot;,&quot;Fees&quot;:&quot;Fee&quot;,&quot;Games&quot;:&quot;Game&quot;,&quot;MusicAlbums&quot;:&quot;Album&quot;,&quot;MusicTracks&quot;:&quot;Song&quot;,&quot;MusicVideos&quot;:&quot;Video&quot;,&quot;MusicArtists&quot;:&quot;Artist&quot;,&quot;OperatingSystem&quot;:&quot;Operating System&quot;,&quot;Software&quot;:&quot;Software&quot;,&quot;Movies&quot;:&quot;Movie&quot;,&quot;TV&quot;:&quot;TV&quot;,&quot;CSV&quot;:&quot;Gift Card&quot;,&quot;VideoActor&quot;:&quot;Actor&quot;}}" data-seautosuggestapi="https://www.microsoft.com/services/api/v3/suggest" data-m="{&quot;cN&quot;:&quot;GlobalNav_Search_cont&quot;,&quot;cT&quot;:&quot;Container&quot;,&quot;id&quot;:&quot;c1c8c2m1r1a1&quot;,&quot;sN&quot;:1,&quot;aN&quot;:&quot;c8c2m1r1a1&quot;}" aria-expanded="false">
                <input id="cli_shellHeaderSearchInput" aria-label="Search" role="combobox" aria-autocomplete="list" aria-controls="universal-header-search-auto-suggest-transparent" aria-owns="universal-header-search-auto-suggest-ul" type="search" name="search" placeholder="Search previous versions" data-m="{&quot;cN&quot;:&quot;SearchBox_nav&quot;,&quot;id&quot;:&quot;n1c1c8c2m1r1a1&quot;,&quot;sN&quot;:1,&quot;aN&quot;:&quot;c1c8c2m1r1a1&quot;}" style="display: none;"><div class="x-screen-reader x-hidden" aria-live="assertive"></div>
                
                <button id="search" aria-label="Search" class="c-glyph" data-m="{&quot;cN&quot;:&quot;Search_nav&quot;,&quot;id&quot;:&quot;n2c1c8c2m1r1a1&quot;,&quot;sN&quot;:2,&quot;aN&quot;:&quot;c1c8c2m1r1a1&quot;}" data-bi-dnt="true" data-bi-mto="true" aria-expanded="false"></button>
                <div class="m-auto-suggest" id="universal-header-search-auto-suggest-transparent" role="group">
                    <ul class="c-menu" id="universal-header-search-auto-suggest-ul" aria-hidden="true" data-bi-dnt="true" data-bi-mto="true" data-js-auto-suggest-position="default" role="listbox" data-tel="jsll" data-m="{&quot;cN&quot;:&quot;search suggestions_cont&quot;,&quot;cT&quot;:&quot;Container&quot;,&quot;id&quot;:&quot;c3c1c8c2m1r1a1&quot;,&quot;sN&quot;:3,&quot;aN&quot;:&quot;c1c8c2m1r1a1&quot;}"></ul>
                </div>
                
            <input name="dataSource" hidden=""></form>

                    
                    
                    
                    
                <div class="auth-control loaded">
	<a class="auth-main docs-sign-in" href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms181055(v%3dsql.105)#" aria-label="Sign in" title="Sign in">
		<div class="auth-title sign-in">Sign in</div>
	</a>
</div></div>
        </div>
        
        
    </div>
                <div class="theme-dark brand-neutral js-cat-head" itemprop="brand" itemscope="itemscope" itemtype="http://schema.org/Brand" data-m="{&quot;cN&quot;:&quot;UHF category nav_cont&quot;,&quot;cT&quot;:&quot;Container&quot;,&quot;id&quot;:&quot;c3m1r1a1&quot;,&quot;sN&quot;:3,&quot;aN&quot;:&quot;m1r1a1&quot;}">

<div>
        <a id="uhfCatLogo" class="c-logo" href="https://docs.microsoft.com/" aria-label="Docs" itemprop="url" data-m="{&quot;cN&quot;:&quot;Docs_nav&quot;,&quot;id&quot;:&quot;n1c3m1r1a1&quot;,&quot;sN&quot;:1,&quot;aN&quot;:&quot;c3m1r1a1&quot;}">
                <span>Docs</span>
        </a>


    <button class="c-action-trigger c-glyph glyph-chevron-left js-primary-paddle" aria-label="Scroll left" title="Scroll left" data-m="{&quot;cN&quot;:&quot;Previous_nonnav&quot;,&quot;id&quot;:&quot;nn2c3m1r1a1&quot;,&quot;sN&quot;:2,&quot;aN&quot;:&quot;c3m1r1a1&quot;}" tabindex="-1" style="display: none;"></button>
    
    <button class="c-action-trigger c-glyph glyph-chevron-right js-secondary-paddle" aria-label="Scroll right" title="Scroll right" data-m="{&quot;cN&quot;:&quot;Next_nonnav&quot;,&quot;id&quot;:&quot;nn3c3m1r1a1&quot;,&quot;sN&quot;:3,&quot;aN&quot;:&quot;c3m1r1a1&quot;}" tabindex="-1" style="display: none;"></button>
            <nav id="uhf-c-nav" role="navigation" aria-label="docs" class="js-paddle-items">

                        <a id="shellmenu_0" class="c-uhf-nav-link" href="https://docs.microsoft.com/en-us/previous-versions" data-m="{&quot;cN&quot;:&quot;CatNav_C1_1-ArchivedDocumentationCategoryMenu_nav&quot;,&quot;id&quot;:&quot;n4c3m1r1a1&quot;,&quot;sN&quot;:4,&quot;aN&quot;:&quot;c3m1r1a1&quot;}" style="transition: margin 0.667s cubic-bezier(0.16, 1, 0.29, 0.99);">Previous Versions Documentation</a>
                    </nav>

</div>


                
            </div>

    
</header>


    </div>
    </div>

    </section>
</div>
	<div id="disclaimer-holder" class="disclaimer-holder">
		<div class="alert disclaimer previous-version-disc" lang="en-us" dir="ltr">
			<p>This content has been retired and may not be updated in the future.  The product, service, or technology mentioned in this content is no longer supported.</p>
		<a class="button-border" href="https://docs.microsoft.com/sql">Recommended Version</a><button type="button" class="button-dismiss no-style"><span class="visually-hidden">Dismiss alert</span></button></div>
	</div>
</div>

	<div class="container-legacy mainContainer" data-bi-name="body">
		<div class="content-header" data-bi-name="content-header">
			<ul class="breadcrumbs" data-bi-name="breadcrumb" itemscope="" itemtype="http://schema.org/BreadcrumbList" role="navigation" aria-label="Breadcrumb"><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a itemprop="item" href="https://docs.microsoft.com/en-us/">Docs</a></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a itemprop="item" href="https://docs.microsoft.com/en-us/previous-versions/">Previous Versions</a></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a itemprop="item" href="https://docs.microsoft.com/en-us/previous-versions/sql">SQL</a></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><span itemprop="name">SQL Server 2008 R2</span></li><li class="mobile-breadcrumb"><a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/cc280362(v%3dsql.105)">Query Processing Architecture</a></li><li>Execution Plan Caching and Reuse</li></ul>
			<div class="content-header-controls exit-focus">
				<button type="button" class="ap-collapse-behavior ap-expanded button-border" data-bi-name="ap-collapse">
					<span class="docon docon-exit-mode"></span>
Exit focus mode				</button>
				
			</div>
			<div class="content-header-controls">
				<button type="button" class="contents-button button-border" data-bi-name="contents-expand">
					<span class="docon docon-menu"></span>
Contents				</button>
			</div>
			<div class="action-bar">
				<ul class="action-list">
					<li>
						<div class="sharing dropdown has-caret" auto-align="">
							<a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms181055(v%3dsql.105)#" class="dropdown-trigger" aria-haspopup="true" aria-controls="sharing-menu" aria-expanded="false" title="Share This Document" data-bi-name="share">
								<span class="docon docon-sharing" aria-hidden="true"></span><span class="action-item-text">Share</span>
							</a>
							<div class="dropdown-menu" id="sharing-menu" role="menu">
								<ul data-bi-name="share-links">
									<li><a class="share-twitter" data-bi-name="twitter" href="https://twitter.com/intent/tweet?original_referer=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Fprevious-versions%2Fsql%2Fsql-server-2008-r2%2Fms181055(v%253dsql.105)%3FWT.mc_id%3Dtwitter&amp;text=Execution%20Plan%20Caching%20and%20Reuse%20%7C%20Microsoft%20Docs&amp;tw_p=tweetbutton&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Fprevious-versions%2Fsql%2Fsql-server-2008-r2%2Fms181055(v%253dsql.105)%3FWT.mc_id%3Dtwitter"><span class="docon docon-brand-twitter" aria-hidden="true"></span>Twitter</a></li>
									<li><a class="share-linkedin" data-bi-name="linkedin" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Fprevious-versions%2Fsql%2Fsql-server-2008-r2%2Fms181055(v%253dsql.105)%3FWT.mc_id%3Dlinkedin"><span class="docon docon-brand-linkedin" aria-hidden="true"></span>LinkedIn</a></li>
									<li><a class="share-facebook" data-bi-name="facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Fprevious-versions%2Fsql%2Fsql-server-2008-r2%2Fms181055(v%253dsql.105)%3FWT.mc_id%3Dfacebook"><span class="docon docon-brand-facebook" aria-hidden="true"></span>Facebook</a></li>
									<li><a class="share-email" data-bi-name="email" href="mailto:?subject=%5BShared%20Article%5D%20Execution%20Plan%20Caching%20and%20Reuse%20%7C%20Microsoft%20Docs&amp;body=Execution%20Plan%20Caching%20and%20Reuse%20%7C%20Microsoft%20Docs%0A%0Ahttps%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Fprevious-versions%2Fsql%2Fsql-server-2008-r2%2Fms181055(v%253dsql.105)%3FWT.mc_id%3Demail"><span class="docon docon-mail-message-fill" aria-hidden="true"></span>Email</a></li>
								</ul>
							</div>
						</div>
					</li>
					<li>
						<button class="toggle-theme" aria-label="toggle-theme" data-bi-name="select-theme"><span class="docon docon-sun"></span><span class="action-item-text">Light</span></button>
					</li>
				</ul>
				<button type="button" class="contents-button" aria-label="Contents" data-bi-name="contents-expand-">
					<span class="docon docon-editor-list-bullet"></span><span>Contents</span>
				</button>
			</div>
		</div>

		<div class="pageActions">
			<div id="page-actions" data-bi-name="pageactions" role="complementary" aria-label="Page Actions">
				<div id="page-actions-content" style="top: 234px; bottom: 24px;">
						<nav id="side-doc-outline" class="doc-outline" data-bi-name="intopic toc" role="navigation" aria-label="On page navigation">
							<h3>In this article</h3>
						<ol><li class="selected"><a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms181055(v%3dsql.105)#removing-execution-plans-from-the-procedure-cache">Removing Execution Plans from the Procedure Cache</a></li><li><a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms181055(v%3dsql.105)#recompiling-execution-plans">Recompiling Execution Plans</a></li><li><a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms181055(v%3dsql.105)#see-also">See Also</a></li></ol></nav>
				</div>
			</div>
		</div>

		<div class="primary-holder x-hidden-focus">

			<main id="main" role="main" class="content" data-bi-name="content" lang="en-us" dir="ltr">


				

					<ul class="metadata page-metadata" data-bi-name="page info" lang="en-us" dir="ltr">
							<li class="displayDate">
								<span aria-hidden="true" class="docon docon-calendar"></span>
								<time role="presentation" datetime="2012-10-03T18:30:00.000Z">10/04/2012</time>
							</li>
							<li class="readingTime">
								<span aria-hidden="true" class="docon docon-clock"></span>
								8 minutes to read
							</li>

					</ul>
						<nav id="center-doc-outline" class="doc-outline" data-bi-name="intopic toc" role="navigation" aria-label="On page navigation">
							<h3>In this article</h3>
						<ol><li><a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms181055(v%3dsql.105)#removing-execution-plans-from-the-procedure-cache">Removing Execution Plans from the Procedure Cache</a></li><li><a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms181055(v%3dsql.105)#recompiling-execution-plans">Recompiling Execution Plans</a></li><li><a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms181055(v%3dsql.105)#see-also">See Also</a></li></ol></nav>

				<!-- <content> -->
					<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml">
<div>
<h1 id="execution-plan-caching-and-reuse">Execution Plan Caching and Reuse</h1>
</div>
<div id="mainSection">
<div id="mainBody">
<div class="introduction">
<p>SQL Server has a pool of memory that is used to store both execution plans and data buffers. The percentage of the pool allocated to either execution plans or data buffers fluctuates dynamically, depending on the state of the system. The part of the memory pool that is used to store execution plans is referred to as the procedure cache.</p>
<p>SQL Server execution plans have the following main components:</p>
<ul>
<li><p>Query Plan</p>
<p>The bulk of the execution plan is a re-entrant, read-only data structure used by any number of users. This is referred to as the query plan. No user context is stored in the query plan. There are never more than one or two copies of the query plan in memory: one copy for all serial executions and another for all parallel executions. The parallel copy covers all parallel executions, regardless of their degree of parallelism.</p>
</li>
<li><p>Execution Context</p>
<p>Each user that is currently executing the query has a data structure that holds the data specific to their execution, such as parameter values. This data structure is referred to as the execution context. The execution context data structures are reused. If a user executes a query and one of the structures is not being used, it is reinitialized with the context for the new user.</p>
</li>
</ul>
<p><img src="./Execution Plan Caching and Reuse _ Microsoft Docs_files/ms181055.srvarch6(en-us,sql.105).gif" alt="Execution context, same query, different literals" title="Execution context, same query, different literals" data-linktype="relative-path"></p>
<p>When any SQL statement is executed in SQL Server, the relational engine first looks through the procedure cache to verify that an existing execution plan for the same SQL statement exists. SQL Server reuses any existing plan it finds, saving the overhead of recompiling the SQL statement. If no existing execution plan exists, SQL Server generates a new execution plan for the query.</p>
<p>SQL Server has an efficient algorithm to find any existing execution plans for any specific SQL statement. In most systems, the minimal resources that are used by this scan are less than the resources that are saved by being able to reuse existing plans instead of compiling every SQL statement.</p>
<p>The algorithms to match new SQL statements to existing, unused execution plans in the cache require that all object references be fully qualified. For example, the first of these SELECT statements is not matched with an existing plan, and the second is matched:</p>
<div class="codeHeader" data-bi-name="code-header"><span class="language"></span>
			<button class="action copy" data-bi-name="copy">
				<span>Copy</span>
			</button></div><pre><code>SELECT * FROM Person;

SELECT * FROM Person.Person;
</code></pre>
</div>
<div>
<h2 id="removing-execution-plans-from-the-procedure-cache">Removing Execution Plans from the Procedure Cache</h2>
<p><span id="sectionToggle0"></span></p>
<p>Execution plans remain in the procedure cache as long as there is enough memory to store them. When memory pressure exists, the Database Engine uses a cost-based approach to determine which execution plans to remove from the procedure cache. To make a cost-based decision, the Database Engine increases and decreases a current cost variable for each execution plan according to the following factors.</p>
<p>When a user process inserts an execution plan into the cache, the user process sets the current cost equal to the original query compile cost; for ad-hoc execution plans, the user process sets the current cost to zero. Thereafter, each time a user process references an execution plan, it resets the current cost to the original compile cost; for ad-hoc execution plans the user process increases the current cost. For all plans, the maximum value for the current cost is the original compile cost.</p>
<p>When memory pressure exists, the Database Engine responds by removing execution plans from the procedure cache. To determine which plans to remove, the Database Engine repeatedly examines the state of each execution plan and removes plans when their current cost is zero. An execution plan with zero current cost is not removed automatically when memory pressure exists; it is removed only when the Database Engine examines the plan and the current cost is zero. When examining an execution plan, the Database Engine pushes the current cost towards zero by decreasing the current cost if a query is not currently using the plan.</p>
<p>The Database Engine repeatedly examines the execution plans until enough have been removed to satisfy memory requirements. While memory pressure exists, an execution plan may have its cost increased and decreased more than once. When memory pressure no longer exists, the Database Engine stops decreasing the current cost of unused execution plans and all execution plans remain in the procedure cache, even if their cost is zero.</p>
<p>The Database Engine uses the resource monitor and user threads to free memory from the procedure cache in response to memory pressure. The resource monitor and user threads can examine plans run concurrently to decrease the current cost for each unused execution plan. The resource monitor&nbsp;removes execution plans from the procedure cache when global memory pressure exists. It frees memory to enforce policies for system memory, process memory, resource pool memory, and maximum size for all caches.</p>
<p>The maximum size for all caches is a function of the buffer pool size and cannot exceed the maximum server memory. For more information on configuring the maximum server memory, see the <strong>max server memory</strong> setting in <a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms188787%28v%3dsql.105%29" data-linktype="relative-path">sp_configure (Transact-SQL)</a>.</p>
<p>The user threads remove execution plans from the procedure cache when single cache memory pressure exists. They enforce policies for maximum single cache size and maximum single cache entries.</p>
<p>The following examples illustrate which execution plans get removed from the procedure cache:</p>
<ul>
<li><p>An execution plan is frequently referenced so that its cost never goes to zero. The plan remains in the procedure cache and is not removed unless there is memory pressure and the current cost is zero.</p>
</li>
<li><p>An ad-hoc execution plan is inserted and is not referenced again before memory pressure exists. Since ad-hoc plans are initialized with a current cost of zero, when the database engine examines the execution plan, it will see the zero current cost and remove the plan from the procedure cache. The ad-hoc execution plan remains in the procedure cache with a zero current cost when memory pressure does not exist.</p>
</li>
</ul>
<p>To manually remove a single plan or all plans from the cache, use <a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms174283%28v%3dsql.105%29" data-linktype="relative-path">DBCC FREEPROCCACHE (Transact-SQL)</a>.</p>
</div>
<div>
<h2 id="recompiling-execution-plans">Recompiling Execution Plans</h2>
<p><span id="sectionToggle1"></span></p>
<p>Certain changes in a database can cause an execution plan to be either inefficient or invalid, based on the new state of the database. SQL Server detects the changes that invalidate an execution plan and marks the plan as not valid. A new plan must then be recompiled for the next connection that executes the query. The conditions that invalidate a plan include the following:</p>
<ul>
<li><p>Changes made to a table or view referenced by the query (ALTER TABLE and ALTER VIEW).</p>
</li>
<li><p>Changes made to a single procedure, which would drop all plans for that procedure from the cache (ALTER PROCEDURE).</p>
</li>
<li><p>Changes to any indexes used by the execution plan.</p>
</li>
<li><p>Updates on statistics used by the execution plan, generated either explicitly from a statement, such as UPDATE STATISTICS, or generated automatically.</p>
</li>
<li><p>Dropping an index used by the execution plan.</p>
</li>
<li><p>An explicit call to <strong>sp_recompile</strong>.</p>
</li>
<li><p>Large numbers of changes to keys (generated by INSERT or DELETE statements from other users that modify a table referenced by the query).</p>
</li>
<li><p>For tables with triggers, if the number of rows in the <strong>inserted</strong> or <strong>deleted</strong> tables grows significantly.</p>
</li>
<li><p>Executing a stored procedure using the WITH RECOMPILE option.</p>
</li>
</ul>
<p>Most recompilations are required either for statement correctness or to obtain potentially faster query execution plans.</p>
<p>In SQL Server 2000, whenever a statement within a batch causes recompilation, the whole batch, whether submitted through a stored procedure, trigger, ad-hoc batch, or prepared statement, is recompiled. In SQL Server 2005 and later, only the statement inside the batch that causes recompilation is recompiled. Because of this difference, recompilation counts in SQL Server 2000 and&nbsp;later releases are not comparable. Also, there are more types of recompilations in SQL Server 2005&nbsp;and later because of its expanded feature set.</p>
<p>Statement-level recompilation benefits performance because, in most cases, a small number of statements causes recompilations and their associated penalties, in terms of CPU time and locks. These penalties are therefore avoided for the other statements in the batch that do not have to be recompiled.</p>
<p>The SQL Server Profiler&nbsp;<strong>SP:Recompile</strong> trace event reports statement-level recompilations. This trace event reports only batch recompilations in SQL Server 2000. Further, the <strong>TextData</strong> column of this event is populated. Therefore, the SQL Server 2000 practice of having to trace <strong>SP:StmtStarting</strong> or <strong>SP:StmtCompleted</strong> to obtain the Transact-SQL text that caused recompilation is no longer required.</p>
<p>The trace event <strong>SQL:StmtRecompile</strong> reports statement-level recompilations. This trace event can be used to track and debug recompilations. Whereas <strong>SP:Recompile</strong> generates only for stored procedures and triggers, <strong>SQL:StmtRecompile</strong> generates for stored procedures, triggers, ad-hoc batches, batches that are executed by using <strong>sp_executesql</strong>, prepared queries, and dynamic SQL.</p>
<p>The <strong>EventSubClass</strong> column of <strong>SP:Recompile</strong> and <strong>SQL:StmtRecompile</strong> contains an integer code that indicates the reason for the recompilation. The following table contains the meaning of each code number.</p>
<div class="caption">
</div>
<div class="tableSection">
<div class="table-scroll-wrapper"><table>
<colgroup>
<col style="">
<col style="">
</colgroup>
<thead>
<tr class="header">
<th><p>EventSubClass value</p></th>
<th><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>1</p></td>
<td><p>Schema changed.</p></td>
</tr>
<tr class="even">
<td><p>2</p></td>
<td><p>Statistics changed.</p></td>
</tr>
<tr class="odd">
<td><p>3</p></td>
<td><p>Deferred compile.</p></td>
</tr>
<tr class="even">
<td><p>4</p></td>
<td><p>SET option changed.</p></td>
</tr>
<tr class="odd">
<td><p>5</p></td>
<td><p>Temporary table changed.</p></td>
</tr>
<tr class="even">
<td><p>6</p></td>
<td><p>Remote rowset changed.</p></td>
</tr>
<tr class="odd">
<td><p>7</p></td>
<td><p>FOR BROWSE permission changed.</p></td>
</tr>
<tr class="even">
<td><p>8</p></td>
<td><p>Query notification environment changed.</p></td>
</tr>
<tr class="odd">
<td><p>9</p></td>
<td><p>Partitioned view changed.</p></td>
</tr>
<tr class="even">
<td><p>10</p></td>
<td><p>Cursor options changed.</p></td>
</tr>
<tr class="odd">
<td><p>11</p></td>
<td><p>OPTION (RECOMPILE) requested.</p></td>
</tr>
</tbody>
</table></div>
</div>
<div class="alert">
<div class="NOTE alert">
<p>Note</p>
<p>When the AUTO_UPDATE_STATISTICS database option is SET to ON, queries are recompiled when they target tables or indexed views whose statistics have been updated or whose cardinalities have changed significantly since the last execution. This behavior applies to standard user-defined tables, temporary tables, and the inserted and deleted tables created by DML triggers. If query performance is affected by excessive recompilations, consider changing this setting to OFF. When the AUTO_UPDATE_STATISTICS database option is SET to OFF, no recompilations occur based on statistics or cardinality changes, with the exception of the inserted and deleted tables that are created by DML INSTEAD OF triggers. Because these tables are created in <strong>tempdb</strong>, the recompilation of queries that access them depends on the setting of AUTO_UPDATE_STATISTICS in <strong>tempdb</strong>. Note that in SQL Server 2000, queries continue to recompile based on cardinality changes to the DML trigger inserted and deleted tables, even when this setting is OFF. For more information about disabling AUTO_UPDATE_STATISTICS, see <a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms190397%28v%3dsql.105%29" data-linktype="relative-path">Using Statistics to Improve Query Performance</a>.</p>
</div>
</div>
</div>
<div>
<h2 id="see-also">See Also</h2>
<p><span id="seeAlsoToggle"></span></p>
<h4 id="reference">Reference</h4>
<div class="seeAlsoStyle">
<p><a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms190911%28v%3dsql.105%29" data-linktype="relative-path">SQL Server, SQL Statistics Object</a></p>
</div>
<h4 id="concepts">Concepts</h4>
<div class="seeAlsoStyle">
<p><a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms175580%28v%3dsql.105%29" data-linktype="relative-path">Parameters and Execution Plan Reuse</a></p>
</div>
<div class="seeAlsoStyle">
<p><a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms186219%28v%3dsql.105%29" data-linktype="relative-path">Simple Parameterization</a></p>
</div>
<div class="seeAlsoStyle">
<p><a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms175037%28v%3dsql.105%29" data-linktype="relative-path">Forced Parameterization</a></p>
</div>
<div class="seeAlsoStyle">
<p><a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms175528%28v%3dsql.105%29" data-linktype="relative-path">Preparing SQL Statements</a></p>
</div>
<div class="seeAlsoStyle">
<p><a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/aa337525%28v%3dsql.105%29" data-linktype="relative-path">Buffer Management</a></p>
</div>
<h4 id="other-resources">Other Resources</h4>
<div class="seeAlsoStyle">
<p><a href="http://go.microsoft.com/fwlink/?linkid=69175" data-linktype="external">Batch Compilation, Recompilation, and Plan Caching Issues in SQL Server 2005</a></p>
</div>
</div>
</div>
</div>
</div>

				<!-- </content> -->


			</main>


		</div>

		<div class="sidebar" id="sidebar" data-bi-name="left toc" role="navigation" aria-label="Main Navigation">
			<button class="sidebar-header" type="button" aria-label="Close" data-bi-name="contents-collapse">
				<span>Contents</span>
				<span class="docon docon-navigate-close" aria-hidden="true"></span>
			</button>
			<div id="sidebarContent" style="top: 234px; bottom: 24px;">
				<div class="filterHolder">
				<form class="tocFilter" aria-label="Filter Table of Contents"><input placeholder="Filter by title" aria-label="Filter" data-bi-name="toc-filter" id="toc-filter" type="search" aria-controls="filterResults"><a href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms181055(v%3dsql.105)#" title="Clear Filter" class="clearInput"><span class="visually-hidden">Clear Filter</span></a></form><div class="emptyFilterMessage">No results</div></div>
				<nav class="toc" role="application" aria-label="Table of Contents" id="filterResults"><ul role="tree" onclick="msDocs.functions.stopSomePropagation(event, &quot;top&quot;)" class="noSibs"><li role="group" aria-expanded="true" aria-label="query processing architecture " onclick="event.stopPropagation();msDocs.functions.toggleAriaExpanded(this)"><a onclick="msDocs.functions.stopSomePropagation(event, &quot;left&quot;)" tabindex="0" href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/cc280362(v%3dsql.105)" data-text="query processing architecture ">Query Processing Architecture</a><ul role="tree" onclick="msDocs.functions.stopSomePropagation(event, &quot;top&quot;)"><li role="treeitem"><a onclick="msDocs.functions.stopSomePropagation(event, &quot;left&quot;)" tabindex="0" href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms190623(v%3dsql.105)" data-text="sql statement processing ">SQL Statement Processing</a></li><li role="treeitem"><a tabindex="0" href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms190201(v%3dsql.105)" data-text="stored procedure and trigger execution ">Stored Procedure and Trigger Execution</a></li><li role="group" aria-expanded="true" aria-label="execution plan caching and reuse " tabindex="0" onclick="event.stopPropagation();msDocs.functions.toggleAriaExpanded(this)" class="noSubs selectedHolder"><a tabindex="0" class="selected" aria-current="page" data-showme="true" href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms181055(v%3dsql.105)" data-text="execution plan caching and reuse ">Execution Plan Caching and Reuse</a><ul role="tree" onclick="msDocs.functions.stopSomePropagation(event, &quot;top&quot;)"><li role="treeitem"><a onclick="msDocs.functions.stopSomePropagation(event, &quot;left&quot;)" tabindex="0" href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms175580(v%3dsql.105)" data-text="parameters and execution plan reuse ">Parameters and Execution Plan Reuse</a></li><li role="treeitem"><a tabindex="0" href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms186219(v%3dsql.105)" data-text="simple parameterization ">Simple Parameterization</a></li><li role="treeitem"><a tabindex="0" href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms175037(v%3dsql.105)" data-text="forced parameterization ">Forced Parameterization</a></li><li role="treeitem"><a tabindex="0" href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms175528(v%3dsql.105)" data-text="preparing sql statements ">Preparing SQL Statements</a></li></ul></li><li role="treeitem"><a tabindex="0" href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms178065(v%3dsql.105)" data-text="parallel query processing ">Parallel Query Processing</a></li><li role="treeitem"><a tabindex="0" href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms191277(v%3dsql.105)" data-text="distributed query architecture ">Distributed Query Architecture</a></li><li role="treeitem"><a tabindex="0" href="https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms345599(v%3dsql.105)" data-text="query processing enhancements on partitioned tables and indexes ">Query Processing Enhancements on Partitioned Tables and Indexes</a></li></ul></li></ul></nav>
				<div class="pdfDownloadHolder"></div>
			</div>
			<div class="tocSpace"></div>
		</div>

	</div>

	<div id="openFeedbackContainer" class="openfeedback-container"></div>

	<div class="footerContainer">
<footer id="footer" data-bi-name="footer" class="footer-layout" role="contentinfo">

    <a data-mscc-ic="false" id="locale-selector-link" href="https://docs.microsoft.com/en-us/locale?target=%2Fen-us%2Fprevious-versions%2Fsql%2Fsql-server-2008-r2%2Fms181055(v%253dsql.105)" data-bi-name="select-locale">English (United States)</a>

    <ul class="links" data-bi-name="footerlinks">
		<li><a data-mscc-ic="false" href="https://docs.microsoft.com/previous-versions/" data-bi-name="archivelink">Previous Version Docs</a></li>
		<li><a data-mscc-ic="false" href="https://docs.microsoft.com/teamblog" data-bi-name="bloglink">Blog</a></li>
		<li><a data-mscc-ic="false" href="https://docs.microsoft.com/contribute" data-bi-name="contributorGuide">Contribute</a></li>
			<li><a data-mscc-ic="false" href="https://privacy.microsoft.com/en-us/" data-bi-name="privacy">Privacy &amp; Cookies</a></li>
		<li><a data-mscc-ic="false" href="https://docs.microsoft.com/en-us/legal/termsofuse" data-bi-name="termsofuse">Terms of Use</a></li>
		<li><a data-mscc-ic="false" href="https://aka.ms/sitefeedback" data-bi-name="feedback">Site Feedback</a></li>
		<li><a data-mscc-ic="false" href="https://www.microsoft.com/en-us/legal/intellectualproperty/Trademarks/EN-US.aspx" data-bi-name="trademarks">Trademarks</a></li>
    </ul>
</footer>	</div>

	<div class="action-panel"></div>

</body></html>